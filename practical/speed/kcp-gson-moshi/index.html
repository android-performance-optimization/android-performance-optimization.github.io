
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="专注于 Android 性能优化领域，分享基础知识，实战方案，学习路线，技术动态等资源">
      
      
      
        <link rel="canonical" href="https://android-performance-optimization.github.io/practical/speed/kcp-gson-moshi/">
      
      
        <link rel="prev" href="../json-serialization-speed/">
      
      
        <link rel="next" href="../../memory/memory-usage-analyse/">
      
      <link rel="icon" href="../../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.1.16">
    
    
      
        <title>使用 KCP 打造更安全的 Gson 与更快的 Moshi - Android 性能优化手册</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kcp-gson-moshi" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Android 性能优化手册" class="md-header__button md-logo" aria-label="Android 性能优化手册" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Android 性能优化手册
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              使用 KCP 打造更安全的 Gson 与更快的 Moshi
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/android-performance-optimization/homepage" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    android-performance-optimization
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        首页
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../resource/" class="md-tabs__link">
      学习资源
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../foundation/self-cultivation/elf-file-detail/" class="md-tabs__link">
        筑基手册
      </a>
    </li>
  

  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../compile/compile-acceleration/" class="md-tabs__link md-tabs__link--active">
        实战手册
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../news/2024/news-2024-11/" class="md-tabs__link">
        技术月报
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Android 性能优化手册" class="md-nav__button md-logo" aria-label="Android 性能优化手册" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    Android 性能优化手册
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/android-performance-optimization/homepage" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    android-performance-optimization
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../..">首页</a>
          
            <label for="__nav_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          首页
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/htc/" class="md-nav__link">
        如何参与
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../resource/" class="md-nav__link">
        学习资源
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          筑基手册
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          筑基手册
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          程序员的自我修养
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          程序员的自我修养
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/self-cultivation/elf-file-detail/" class="md-nav__link">
        Elf 文件格式详解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/self-cultivation/static-link/" class="md-nav__link">
        静态链接
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/self-cultivation/elf-load/" class="md-nav__link">
        ELF 文件的装载与进程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/self-cultivation/dynamic-link/" class="md-nav__link">
        动态链接
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/self-cultivation/memory/" class="md-nav__link">
        内存
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/self-cultivation/system-call/" class="md-nav__link">
        系统调用
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          深入实践 Kotlin 元编程
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          深入实践 Kotlin 元编程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-meta-programming/meta-programming-basic/" class="md-nav__link">
        元编程概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-meta-programming/meta-data-introduction/" class="md-nav__link">
        元数据简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-meta-programming/runtime-reflect/" class="md-nav__link">
        运行时的反射
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-meta-programming/code-generate/" class="md-nav__link">
        源代码生成
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-meta-programming/symbol-process/" class="md-nav__link">
        编译时的符号处理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-meta-programming/code-static-analyse/" class="md-nav__link">
        程序静态分析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-meta-programming/compiler-extension/" class="md-nav__link">
        编译器插件
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-meta-programming/meta-programming-debug/" class="md-nav__link">
        元程序的开发和调试
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          Kolin 编译器学习
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Kolin 编译器学习
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-compiler-learn/learning-resource/" class="md-nav__link">
        Kotlin 编译器相关学习资源
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-compiler-learn/kotlin-compiler-start/" class="md-nav__link">
        Kotlin 编译器源码阅读
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/kotlin-compiler-learn/kotlin-compiler-source/" class="md-nav__link">
        破解 Kotlin 编译器
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          C 和指针
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          C 和指针
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/environment-config/" class="md-nav__link">
        环境搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/quick-start/" class="md-nav__link">
        快速上手
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/basic-concept/" class="md-nav__link">
        基本概念
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/data-type/" class="md-nav__link">
        数据类型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/statement/" class="md-nav__link">
        语句
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/operators-and-expressions/" class="md-nav__link">
        操作符和表达式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/pointer/" class="md-nav__link">
        指针
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/function/" class="md-nav__link">
        函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/array/" class="md-nav__link">
        数组
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/char-and-string/" class="md-nav__link">
        字符串、字符和字节
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/struct-and-union/" class="md-nav__link">
        结构和联合
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/dynamic-memory/" class="md-nav__link">
        动态内存分配
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/struct-and-pointer/" class="md-nav__link">
        使用结构和指针
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/advanced-pointer/" class="md-nav__link">
        高级指针话题
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/pointers-on-c/preprocessor/" class="md-nav__link">
        预处理器
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          计算机系统要素
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          计算机系统要素
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/introduction/" class="md-nav__link">
        前言
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/bool-logic/" class="md-nav__link">
        布尔逻辑
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/bool-arithmetic/" class="md-nav__link">
        布尔运算
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/sequential-logic/" class="md-nav__link">
        时序逻辑
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/machine-language/" class="md-nav__link">
        机器语言
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/computer-architecture/" class="md-nav__link">
        计算机体系结构
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/assembler/" class="md-nav__link">
        汇编编译器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/virtual-machine-one/" class="md-nav__link">
        虚拟机 1：堆栈运算
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/virtual-machine-two/" class="md-nav__link">
        虚拟机 2： 程序控制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/compiler-one/" class="md-nav__link">
        编译器 1：语法分析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/compiler-two/" class="md-nav__link">
        编译器 2: 代码生成
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/nand-to-tetris/recommend/" class="md-nav__link">
        【书籍推荐】如何从最基础原理做出一个计算机
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          Android 系统基础
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Android 系统基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/framework/activity-start/" class="md-nav__link">
        Activity 启动流程分析
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
          实用工具系列
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          实用工具系列
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../foundation/tools/native-hook/" class="md-nav__link">
        Native Hook 快速上手
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          实战手册
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          实战手册
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          编译优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          编译优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../compile/compile-acceleration/" class="md-nav__link">
        编译加速的8个实用技巧
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../compile/now-in-android/" class="md-nav__link">
        nowinandroid 构建脚本学习
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          代码质量优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          代码质量优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../code-quality/kotlin-detekt/" class="md-nav__link">
        落地 Kotlin 代码规范，DeteKt 了解一下
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          稳定性优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          稳定性优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../stability/airbag/" class="md-nav__link">
        安全气囊如何实现？
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          速度优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          速度优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../json-serialization-speed/" class="md-nav__link">
        常用 JSON 库性能对比
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          使用 KCP 打造更安全的 Gson 与更快的 Moshi
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        使用 KCP 打造更安全的 Gson 与更快的 Moshi
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    前言
  </a>
  
    <nav class="md-nav" aria-label="前言">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    空安全与默认值问题
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    性能问题
  </a>
  
    <nav class="md-nav" aria-label="性能问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    多次运行测试结果
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    一次运行测试结果
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kudos" class="md-nav__link">
    Kudos 是什么
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kudos_1" class="md-nav__link">
    Kudos 使用
  </a>
  
    <nav class="md-nav" aria-label="Kudos 使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-classpath" class="md-nav__link">
    1. 添加插件到 classpath
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    在项目中启用插件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kudos_2" class="md-nav__link">
    为特定类启动 Kudos 的支持
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    原理解析：前置知识
  </a>
  
    <nav class="md-nav" aria-label="原理解析：前置知识">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    编译器插件是什么？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2-k1" class="md-nav__link">
    K2 编译器与 K1 编译器
  </a>
  
    <nav class="md-nav" aria-label="K2 编译器与 K1 编译器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    编译器前端
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    编译器后端
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    编译器扩展点
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kudos_3" class="md-nav__link">
    Kudos 原理解析
  </a>
  
    <nav class="md-nav" aria-label="Kudos 原理解析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    项目结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kudos_4" class="md-nav__link">
    Kudos 如何保证空安全与默认值？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kudos-jsonreader" class="md-nav__link">
    Kudos 如何简化 JsonReader 的使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kudos-compiler" class="md-nav__link">
    kudos-compiler 的实现
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    性能数据
  </a>
  
    <nav class="md-nav" aria-label="性能数据">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    多次运行测试结果
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    一次运行测试结果
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kotlin" class="md-nav__link">
    如何学习 Kotlin 编译器插件
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    总结
  </a>
  
    <nav class="md-nav" aria-label="总结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    开源地址
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
          内存优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          内存优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../memory/memory-usage-analyse/" class="md-nav__link">
        App 内存占用分析
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          技术月报
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          技术月报
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
          2024
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          2024
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-11/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 11 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-10/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 10 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-09/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 9 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-08/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 8 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-07/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 7 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-06/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 6 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-05/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 5 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-04/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 4 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-03/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 3 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-02/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 2 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2024/news-2024-01/" class="md-nav__link">
        Android 性能优化技术月报 | 2024 年 1 月
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          2023
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          2023
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2023/news-2023-12/" class="md-nav__link">
        Android 性能优化技术月报 | 2023 年 12 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2023/news-2023-11/" class="md-nav__link">
        Android 性能优化技术月报 | 2023 年 11 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2023/news-2023-10/" class="md-nav__link">
        Android 性能优化技术月报 | 2023 年 10 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2023/news-2023-09/" class="md-nav__link">
        Android 性能优化技术月报 | 2023 年 9 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2023/news-2023-08/" class="md-nav__link">
        Android 性能优化技术月报 | 2023 年 8 月
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../news/2023/news-2023-07/" class="md-nav__link">
        Android 性能优化技术月报 | 2023 年 7 月
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    前言
  </a>
  
    <nav class="md-nav" aria-label="前言">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    空安全与默认值问题
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    性能问题
  </a>
  
    <nav class="md-nav" aria-label="性能问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    多次运行测试结果
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    一次运行测试结果
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kudos" class="md-nav__link">
    Kudos 是什么
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kudos_1" class="md-nav__link">
    Kudos 使用
  </a>
  
    <nav class="md-nav" aria-label="Kudos 使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-classpath" class="md-nav__link">
    1. 添加插件到 classpath
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    在项目中启用插件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kudos_2" class="md-nav__link">
    为特定类启动 Kudos 的支持
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    原理解析：前置知识
  </a>
  
    <nav class="md-nav" aria-label="原理解析：前置知识">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    编译器插件是什么？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2-k1" class="md-nav__link">
    K2 编译器与 K1 编译器
  </a>
  
    <nav class="md-nav" aria-label="K2 编译器与 K1 编译器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    编译器前端
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    编译器后端
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    编译器扩展点
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kudos_3" class="md-nav__link">
    Kudos 原理解析
  </a>
  
    <nav class="md-nav" aria-label="Kudos 原理解析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    项目结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kudos_4" class="md-nav__link">
    Kudos 如何保证空安全与默认值？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kudos-jsonreader" class="md-nav__link">
    Kudos 如何简化 JsonReader 的使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kudos-compiler" class="md-nav__link">
    kudos-compiler 的实现
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    性能数据
  </a>
  
    <nav class="md-nav" aria-label="性能数据">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    多次运行测试结果
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    一次运行测试结果
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kotlin" class="md-nav__link">
    如何学习 Kotlin 编译器插件
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    总结
  </a>
  
    <nav class="md-nav" aria-label="总结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    开源地址
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="kcp-gson-moshi">使用 KCP 打造更安全的 Gson 与更快的 Moshi</h1>
<h2 id="_1">前言</h2>
<p>众所周知，使用 Gson、Jackson 等框架反序列化 JSON 到 Kotlin 类时存在空安全问题和构造器默认值失效的问题，同时常用的 Gson, Moshi 等框架往往在功能上比较强大，全面，而在性能上却没有很明显的优势。本文将介绍如何使用 Kotlin 编译器插件打造更安全的 Gson 与更快的 Moshi。</p>
<h3 id="_2">空安全与默认值问题</h3>
<p><img alt="" src="https://raw.gitmirror.com/RicardoJiang/resource/main/2023/december/p5.png" /></p>
<p>如上图所示，我们在使用 Gson 将 Json 数据反序列化为 <code>User</code> 对象时，会遇到空值安全问题和默认构造参数失效的问题。下面让我们来探讨一下为何会出现这样的情况。</p>
<p><img alt="" src="https://raw.gitmirror.com/RicardoJiang/resource/main/2023/december/p6.png" /></p>
<ul>
<li>当调用<code>Gson.fromJson</code>方法来反序列化对象时，首先会创建<code>Adapter</code></li>
<li>在创建<code>Adapter</code>的过程时需要获取类的构建函数，如果存在无参构建函数会直接返回，否则会通过 UnSafe 的方式创建</li>
<li>当使用 UnSafe 方式创建时，就不会调用我们定义的主构造函数了，默认值自然也就失效了</li>
<li>在<code>Adapter</code>创建后，接下来就是在<code>Adapter</code>中通过<code>jsonReader</code>读取输入</li>
<li>在读取输入的过程中通过<code>field.set(target, fieldValue)</code>反射赋值，自然也就无法保证空安全了</li>
</ul>
<h3 id="_3">性能问题</h3>
<p>反序列化是 Android 开发中必备且非常高频的需求，因此一个高性能的反序列化框架就非常重要了，那么常用的 Gson 与 Moshi 等框架性能到底怎么样呢?</p>
<p>下面列出使用 Jetpack Microbenchmark 库测试常用反序列化框架的结果，具体测试过程可见：<a href="https://android-performance-optimization.github.io/practical/speed/json-serialization-speed/">常用 JSON 库性能对比</a></p>
<h4 id="_4">多次运行测试结果</h4>
<p><img alt="" src="https://raw.gitmirror.com/RicardoJiang/resource/main/2023/october/DeserializationSpeedMultiTimes.png" /></p>
<p>从柱状图可以很明显的看出各个框架的速度对比</p>
<ul>
<li>Kotlin Serialization 看起来是最适合 Kotlin 的反序列化框架，在各个框架中表现最好</li>
<li>JSONReader 与 JSONObject 在小数据上表现也不错，在大数据上 JSONReader 与其它框架相差不大，而 JSONObject 由于要将 InputStream 转化成 String，表现较差</li>
<li>Moshi 与 Gson 在反序列化速度上差距不大，基本上是一个量级，但相比 JSONReader 等框架则明显较慢</li>
</ul>
<h4 id="_5">一次运行测试结果</h4>
<p><img alt="" src="https://raw.gitmirror.com/RicardoJiang/resource/main/2023/october/DeserializationSpeedRunOnce.png" /></p>
<p>可以看出，一次运行测试结果与多次运行测试结果明显不同</p>
<ul>
<li>JSONReader 与 JSONObject 相比其它框架优势明显，在冷启动场景使用这些系统原生 API 应该会有一定优势</li>
<li>在冷启动场景，Moshi 与 Kotlin Serialization 速度差不多，相比 Gson 则略慢</li>
</ul>
<p>根据上述结果，可以看出 JSONReader 这些原生 API 在冷启动场景有极大优势，在经过充分优化后相比 Gson, Moshi 等库仍然有一定优势。因此，如果要实现更高性能的反序列化，使用 JSONReader 代替 Gson 与 Moshi，应该是个不错的选择。</p>
<p>但是 JSONReader 这些原生 API 使用起来较为麻烦，需要写很多模板代码，我们该如何优化呢？答案就是 Kudos。</p>
<h2 id="kudos">Kudos 是什么</h2>
<p>Kudos 是 Kotlin utilities for deserializing objects 的缩写。它可以解决使用 Gson、Jackson 等框架反序列化 JSON 到 Kotlin 类时所存在的空安全问题和构造器默认值失效的问题，同时可以简化高性能的反序列化框架 JsonReader 的使用方式。</p>
<p>Kudos 已经在 Github 上开源，开源地址可见：<a href="https://github.com/kanyun-inc/Kudos">https://github.com/kanyun-inc/Kudos</a></p>
<h2 id="kudos_1">Kudos 使用</h2>
<p>引入 Kudos 主要分为以下几步</p>
<h3 id="1-classpath">1. 添加插件到 classpath</h3>
<pre><code class="language-kotlin">// 方式 1
// 传统方式，在根目录的 build.gradle.kts 中添加以下代码
buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath(&quot;com.kanyun.kudos:kudos-gradle-plugin:$latest_version&quot;)
    }
}

// 方式 2
// 引用插件新方式，在 settings.gradle.kts 中添加以下代码
pluginManagement {
    repositories {
        mavenCentral()
    }
    plugins {
        id(&quot;com.kanyun.kudos&quot;) version &quot;$latest_version&quot; apply false
    }
}
</code></pre>
<h3 id="_6">在项目中启用插件</h3>
<pre><code class="language-kotlin">plugins {
    // 启用 Kudos 插件. 
    // 为被 @Kudos 注解标注的类生成优化版本的无参构造器
    id(&quot;com.kanyun.kudos&quot;)
}

kudos {
    // 启用 Kudos.Gson. 为被 @Kudos 标注的类同时生成 @JsonAdapter 注解，并添加 kudos-gson 依赖.
    gson = true
    // 启用 Kudos.Jackson. 添加 kudos-jackson 依赖.
    jackson = true
    // 启用 Kudos.AndroidJsonReader. 添加 kudos-android-json-reader 依赖.
    androidJsonReader = true
}
</code></pre>
<p>我们可以在模块级别配置 Kudos 的功能开关</p>
<ul>
<li>当设置<code>gson = true</code>时就会启用 Kudos.Gson，实现更安全的 Gson</li>
<li>当设置<code>jackson = true</code>时就会启用 Kudos.jackson，实现更安全的 Jackson</li>
<li>当设置<code>androidJsonReader = true</code>时就会启用 Kudos.AndroidJsonReader，简化 JsonReader 的使用</li>
</ul>
<h3 id="kudos_2">为特定类启动 Kudos 的支持</h3>
<pre><code class="language-kotlin">@Kudos
data class User(
    val id: Long, 
    val name: String,
    val age: Int = -1,
    val tel: String = &quot;&quot;
)

@Kudos(KUDOS_GSON)
data class User(
    val id: Long, 
    val name: String,
    val age: Int = -1,
    val tel: String = &quot;&quot;
)
</code></pre>
<ul>
<li>对于需要添加 Kudos 解析支持的类型，直接添加<code>@Kudos</code>注解即可</li>
<li><code>@Kudos</code>注解的类的功能默认与模块配置一致，也可以添加参数例如<code>@Kudos(KUDOS_GSON)</code>实现针对该类只开启特定功能</li>
</ul>
<h2 id="_7">原理解析：前置知识</h2>
<h3 id="_8">编译器插件是什么？</h3>
<p>Kotlin 的编译过程，简单来说就是将 Kotlin 源代码编译成目标产物的过程，具体步骤如下图所示：</p>
<p><img alt="" src="https://raw.gitmirror.com/RicardoJiang/resource/main/2023/december/p7.png" /></p>
<p>Kotlin 编译器插件，通过利用编译过程中提供的各种 Hook 时机，让我们可以在编译过程中插入自己的逻辑，以达到修改编译产物的目的</p>
<p>Kotlin 编译器插件可以分为 Gradle 插件，编译器插件，IDE 插件三部分，如下图所示</p>
<p><img alt="" src="https://raw.gitmirror.com/RicardoJiang/resource/main/2023/december/p8.png" /></p>
<h3 id="k2-k1">K2 编译器与 K1 编译器</h3>
<p><img alt="" src="https://raw.gitmirror.com/RicardoJiang/resource/main/2023/december/p9.png" /></p>
<h4 id="_9">编译器前端</h4>
<p>Kotlin 编译器可以分为编译器前端与编译器后端两部分，目前 Kotlin 编译器前端有两个版本，一个是老版本的 PSI 版本，一个是即将在 Kotlin 2.0 版本稳定的 FIR 版本。</p>
<p>PSI 即 Program Structure Interface，PSI 原本是 Intellij 平台对各类编程语言语法树的统一抽象，为了快速实现需求，Kotlin 团队在开发初期复用了 Intellij 平台已经有的技术积累。而从 Kotlin 1.6 版本开始，为了实现更好的编译器性能，Kotlin团队开始开发一款全新的前端编译器，即 K2 编译器的 FIR 前端。</p>
<p>因此当我们开发编译器插件时，在涉及编译器前端的修改时需要同时适配 K1 与 K2 两个版本。</p>
<h4 id="_10">编译器后端</h4>
<p>同时 Kotlin 作为一个多平台语言，可以将源代码编译成多个平台的目标代码，比如 Kotlin/Jvm 可以生成 Java 字节码，Kotlin/Js 可以生成 Javascript，Kotlin/Native 可以生成 .so 文件。</p>
<p>不同的编译器后端之间必然有不少逻辑可以共享，因此为了在不同的后端之间共享逻辑，降低支持新的语言特性的成本，同时方便后续扩展支持新的平台，Kotlin 编译器后端引入了 IR 这一中间层。</p>
<p>不过由于 Kotlin/Jvm 已经在 Kotlin 1.5 版本支持了 IR，Kotlin/Js 在 Kotlin 1.6 版本支持了 IR，而 Kotlin/Native 在一开始就支持 IR，因此我们在开发编译器插件时，涉及修改 IR 时不需要做什么额外的适配。</p>
<h3 id="_11">编译器扩展点</h3>
<p>前面提到 Kotlin 编译器插件，通过利用编译过程中提供的各种扩展点，让我们可以在编译过程中插入自己的逻辑，以达到修改编译产物的目的，下面就介绍一下 Kudos 中使用到的扩展点以及对应的 API</p>
<table>
<thead>
<tr>
<th>扩展的类名</th>
<th>编译阶段</th>
<th>功能说明</th>
<th>用例</th>
</tr>
</thead>
<tbody>
<tr>
<td>SyntheticResolveExtension</td>
<td>前端</td>
<td>解析生成的类，函数等，可用于给类添加接口或者方法</td>
<td>Parcelize</td>
</tr>
<tr>
<td>FirExtensionRegistrar</td>
<td>前端</td>
<td>FIR 扩展，可用于提供代码声明信息与代码检查</td>
<td>Parcelize</td>
</tr>
<tr>
<td>StorageComponentContainerContributor</td>
<td>前端</td>
<td>可用于编译期代码检查</td>
<td>Compose</td>
</tr>
<tr>
<td>IrGenerationExtension</td>
<td>多平台 IR 后端</td>
<td>生成与修改 IR</td>
<td>Parcelize、Atomicfu、NoArg</td>
</tr>
</tbody>
</table>
<p>总得来说，在涉及到修改类或者函数的声明，例如函数的签名信息，给类添加接口等内容时，需要使用到编译器前端的扩展点；而当涉及到方法体的内部实现，类的私有属性等内容时，直接生成或修改 IR 即可。</p>
<h2 id="kudos_3">Kudos 原理解析</h2>
<h3 id="_12">项目结构</h3>
<p><img alt="" src="https://raw.gitmirror.com/RicardoJiang/resource/main/2023/december/p10.png" /></p>
<p>我们知道，Kudos 是一个 Kotlin 编译器插件，当然也可以分为 Gradle 插件，编译器插件，IDE 插件三部分，为了支持 Jackson，Kudos 也提供了 Maven 集成能力。</p>
<p>同时 Kudos 添加了对 Gson, Jackson, JsonReader 等框架的增强，针对这些框架的定制化代码封装在特定的 runtime 模块中，只有开启了对应的功能开关才会引入。</p>
<h3 id="kudos_4">Kudos 如何保证空安全与默认值？</h3>
<p>前面介绍了 Kotlin 编译器插件相关的前置知识，那么 Kudos 到底是如何保证空安全与默认值的呢？</p>
<pre><code class="language-kotlin">@Kudos
data class User(
    val id: Long, 
    val name: String,
    val age: Int = -1,
    val tel: String = &quot;&quot;
)
</code></pre>
<p>上面这段代码，在编译过后大致相当于</p>
<pre><code class="language-kotlin">@Kudos
// 如果启用了 com.kanyun.kudos.gson 插件，则生成 @JsonAdapter 注解
@JsonAdapter(value = KudosReflectiveTypeAdapterFactory::class)
data class User(
    val id: Long, 
    val name: String,
    val age: Int = -1,
    val tel: String = &quot;&quot;
) : KudosValidator {
    constructor() { // 生成的默认无参构造器
        super() // 调用父类默认无参构造器
        init&lt;User&gt;() // 调用 User 类内部的 init 块（包括定义在内部的属性初始化）
        this.age = -1 // 使用主构造器的参数默认值初始化属性
        this.tel = &quot;&quot; // 使用主构造器的参数默认值初始化属性
    }

    // 生成的用于校验字段空安全的函数
    override fun validate(status: Map&lt;String, Boolean&gt;) {
        validateField(&quot;id&quot;, status)
        validateField(&quot;name&quot;, status)
    }
}
</code></pre>
<ul>
<li>Kudos 插件会生成默认无参构造器，在其中使用主构造器的参数默认值初始化属性，因此可以避免默认值失效。</li>
<li>当启用了 Kudos.gson 时，会给类添加<code>@JsonAdapter</code>注解，在自定义的<code>KudosReflectiveTypeAdapterFactory</code>中自定义反序列化逻辑</li>
<li>Kudos 插件同样会给类添加<code>KudosValidator</code>接口与<code>validate</code>方法，在<code>validate</code>方法体中会给没有默认值的非空属性添加<code>validateField</code>调用</li>
<li>在<code>KudosReflectiveTypeAdapterFactory</code>中在反序列化完成后会调用<code>KudosValidator</code>的<code>validate</code>方法，以验证声明非空的属性是否不为空，否则会抛出异常</li>
</ul>
<h3 id="kudos-jsonreader">Kudos 如何简化 JsonReader 的使用</h3>
<p>JsonReader 使用起来麻烦的原因就在于要写很多模板代码，我们通过编译器插件来生成这些模板代码就可以解决 JsonReader 使用麻烦的问题。同时当我们开启 Kudos.AndroidJsonReader, 之前的保证默认值生效与空安全的代码也同样能生效。编译过后的代码如下所示：</p>
<pre><code class="language-kotlin">@Kudos
data class User(
    val id: Long, 
    val name: String,
    val age: Int = -1,
    val tel: String = &quot;&quot;
) : KudosJsonAdapter {
    private var kudosFieldStatusMap: Map&lt;String, Boolean&gt; = hashMapOf()

    override fun fromJson(jsonReader: JsonReader): User {
        jsonReader.beginObject()
        while (jsonReader.hasNext()) {
            val tmp0 = jsonReader.nextName()
            if (jsonReader.peek() == JsonToken.NULL) {
                jsonReader.skipValue()
                continue
            }
            when {
                tmp0 == &quot;id&quot; -&gt; {
                    &lt;this&gt;.id = jsonReader.nextLong()
                    &lt;this&gt;.kudosFieldStatusMap.put(&quot;id&quot;, &lt;this&gt;.id != null)
                }
                tmp0 == &quot;name&quot; -&gt; {
                    &lt;this&gt;.name = jsonReader.nextString()
                    &lt;this&gt;.kudosFieldStatusMap.put(&quot;name&quot;, &lt;this&gt;.name != null)
                }
                // ...
                else -&gt; {
                    jsonReader.skipValue()
                }
            }
        }
        jsonReader.endObject()
        validate(&lt;this&gt;.kudosFieldStatusMap)
        return this
    }
}
</code></pre>
<h3 id="kudos-compiler">kudos-compiler 的实现</h3>
<p><img alt="" src="https://raw.gitmirror.com/RicardoJiang/resource/main/2023/december/p11.png" /></p>
<p>前面我们介绍了 kudos-compiler 模块要实现的代码，那么作为提供核心能力的模块，kudos-compiler 具体又是如何实现的呢？</p>
<ul>
<li>KudosCommandLineProcessor 作为编译件插件的入口，注册 pluginId，同时接收命令行或者 gradle 插件传过来的参数</li>
<li>KudosCompilerPluginRegistrar 的作用则是用于注册我们所需的各种扩展点</li>
<li>KudosSyntheticResolveExtension 的作用是在符号引用解析时提供声明信息在符号引用解析时提供声明信息，比如给类添加<code>KudosValidator</code>接口与<code>validate</code>方法</li>
<li>KudosFirExtensionRegistrar 的作用是在 K2 解析时提供声明信息与代码检查，与 KudosSyntheticResolveExtension 类似，区别在于两者适用的编译器前端版本不同</li>
<li>KudosComponentContainerContributor 的作用是提供代码编译期检查</li>
<li>KudosIrGenerationExtension 的作用是在编译产物中提供实现，比如<code>validate</code>与<code>fromJson</code>的方法体</li>
</ul>
<h2 id="_13">性能数据</h2>
<p>基于 Kudos 的工作机制不难想到，Kudos 的运行耗时会略微多于对应的 JSON 序列化框架。</p>
<p>使用 Jetpack Microbenchmark 库对 Kudos 与其对应的 JSON 序列化框架进行性能对比可以发现，Kudos.Gson 的耗时为 Gson 的 1.1-1.2 倍, Kudos.Jackson, KudosAndroidJsonReader 的情况类似，在可接受的范围之内。</p>
<h3 id="_14">多次运行测试结果</h3>
<table>
<thead>
<tr>
<th></th>
<th>small json</th>
<th>medium json</th>
<th>large json</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gson</td>
<td>412,375   ns</td>
<td>1,374,838   ns</td>
<td>3,641,904   ns</td>
</tr>
<tr>
<td>Kudos-Gson</td>
<td>517,123   ns</td>
<td>1,686,568   ns</td>
<td>4,311,910   ns</td>
</tr>
<tr>
<td>Jackson</td>
<td>1,035,010   ns</td>
<td>1,750,709   ns</td>
<td>3,450,974   ns</td>
</tr>
<tr>
<td>Kudos-Jackson</td>
<td>1,261,026   ns</td>
<td>2,030,874   ns</td>
<td>3,939,600   ns</td>
</tr>
<tr>
<td>JsonReader</td>
<td>190,302   ns</td>
<td>1,176,479   ns</td>
<td>3,464,174   ns</td>
</tr>
<tr>
<td>Kudos-JsonReader</td>
<td>215,974   ns</td>
<td>1,359,587   ns</td>
<td>4,019,024   ns</td>
</tr>
</tbody>
</table>
<h3 id="_15">一次运行测试结果</h3>
<table>
<thead>
<tr>
<th></th>
<th>small json</th>
<th>medium json</th>
<th>large json</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gson</td>
<td>3,974,219   ns</td>
<td>4,666,927   ns</td>
<td>8,271,355   ns</td>
</tr>
<tr>
<td>Kudos-Gson</td>
<td>4,531,718   ns</td>
<td>6,244,479   ns</td>
<td>11,160,782   ns</td>
</tr>
<tr>
<td>Jackson</td>
<td>12,821,094   ns</td>
<td>13,930,625   ns</td>
<td>15,989,791   ns</td>
</tr>
<tr>
<td>Kudos-Jackson</td>
<td>13,233,750   ns</td>
<td>15,674,010   ns</td>
<td>18,641,302   ns</td>
</tr>
<tr>
<td>JsonReader</td>
<td>662,032   ns</td>
<td>2,056,666   ns</td>
<td>4,624,687   ns</td>
</tr>
<tr>
<td>Kudos-JsonReader</td>
<td>734,907   ns</td>
<td>2,362,010   ns</td>
<td>6,212,917   ns</td>
</tr>
</tbody>
</table>
<h2 id="kotlin">如何学习 Kotlin 编译器插件</h2>
<p>Kotlin 编译器插件目前还没有稳定，没有稳定的 API 与文档，那么我们该如何学习 Kotlin 编译器插件呢？</p>
<ul>
<li>通过 Kotlin 源码学习：由于没有文档，Kotlin 源码实际上就是最新的文档，如果想要学习 KCP，可以先从 Kotlin 官方开发的插件，例如 Parcelize, NoArg 等开始</li>
<li>通过 AI 学习：当我们在开发编译器插件时，往往是知道想要生成的代码的样式，却由于没有 API 不知道如何实现，这种场景正是 AI 的用武之地了，我们可以提供给 AI 想要生成的代码示例，返回编译器插件的实现。</li>
<li>学习《深入实践 Kotlin 元编程》：这本书是目前少有的针对 Kotlin 编译器插件做了系统介绍的学习资料，除此之外，还介绍了反射，代码生成，程序静态分析，符号处理器等 Kotlin 元编程技术，想要深入学习 Kotlin 元编程的同学都可以了解下。</li>
</ul>
<p><img alt="" src="https://raw.gitmirror.com/RicardoJiang/resource/main/2023/august/p3.png" /></p>
<h2 id="_16">总结</h2>
<p>本文主要介绍了如何使用 Kudos ，以及 Kudos 到底是如何实现的，如果有任何问题，欢迎提出 Issue，如果对你有所帮助，欢迎点赞收藏 Star ~</p>
<h3 id="_17">开源地址</h3>
<p><a href="https://github.com/kanyun-inc/Kudos">https://github.com/kanyun-inc/Kudos</a></p>

  <hr>
<div class="md-source-file">
  <small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 1, 2024</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            回到页面顶部
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../json-serialization-speed/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 常用 JSON 库性能对比" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                常用 JSON 库性能对比
              </div>
            </div>
          </a>
        
        
          
          <a href="../../memory/memory-usage-analyse/" class="md-footer__link md-footer__link--next" aria-label="下一页: App 内存占用分析" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                App 内存占用分析
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.a51614de.min.js"></script>
      
    
  </body>
</html>